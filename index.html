<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Interactive Quiz</title>
    <style>
        :root {
            /* Light mode variables */
            --background-color: #ffffff;
            --text-color: #333333;
            --container-bg: #f9f9f9;
            --option-bg: #e3f2fd;
            --option-border: #90caf9;
            --option-hover: #bbdefb;
            --correct-bg: #c8e6c9;
            --correct-color: #2e7d32;
            --incorrect-bg: #ffcdd2;
            --incorrect-color: #c62828;
            --skipped-color: #ff9800;
            --button-bg: #2196f3;
            --button-color: white;
            --disabled-button: #bdbdbd;
            --score-container: #e8f5e9;
            --json-sample-bg: #f5f5f5;
            --modal-bg: #fff;
            --modal-overlay: rgba(0,0,0,0.7);
            
            /* Font variables */
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', 'Cascadia Code', 'Fira Code', Consolas, 'Courier New', monospace;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-bold: 600;
        }
        
        /* Dark mode variables */
        [data-theme="dark"] {
            --background-color: #1e1e2e;
            --text-color: #cdd6f4;
            --container-bg: #2a2b3c;
            --option-bg: #313244;
            --option-border: #45475a;
            --option-hover: #585b70;
            --correct-bg: #294c3d;
            --correct-color: #a6e3a1;
            --incorrect-bg: #5e3c40;
            --incorrect-color: #f38ba8;
            --skipped-color: #fab387;
            --button-bg: #89b4fa;
            --button-color: #1e1e2e;
            --disabled-button: #45475a;
            --score-container: #313244;
            --json-sample-bg: #1e1e2e;
            --modal-bg: #313244;
            --modal-overlay: rgba(0,0,0,0.85);
        }
        
        /* Fireworks animation */
        .pyro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            pointer-events: none;
            overflow: hidden;
        }
        
        .pyro > .before, .pyro > .after {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            box-shadow: 0 0 #fff;
            animation: 1.25s bang ease-out infinite backwards, 1.25s gravity ease-in infinite backwards, 6.5s position linear infinite backwards;
        }
        
        .pyro > .after {
            animation-delay: 0.4s, 0.4s, 0.4s;
            animation-duration: 1.5s, 1.5s, 7s;
        }
        
        @keyframes bang {
            from {
                box-shadow: 0 0 #fff;
            }
            to {
                box-shadow: 
                -70px -120.67px #ff0055, 
                -100px -90px #ff9500, 
                60px -160px #00ff73, 
                30px -170px #ff0004, 
                -130px -160px #ff7300, 
                -60px -120px #00ffb3, 
                -80px -90px #ff0400, 
                140px -70px #ff9900, 
                40px -100px #ff0044, 
                -90px -50px #0099ff, 
                80px -120px #ff0400, 
                110px -130px #00ff11, 
                -120px -110px #ff8800, 
                -50px -70px #0400ff, 
                60px -80px #0026ff, 
                -110px -90px #ff5900, 
                -80px -60px #ffae00, 
                170px -90px #ff6600, 
                -80px -40px #ff004c, 
                120px -70px #00ffd5,
                -120px -20px #8400ff, 
                140px -30px #ffee00,
                -100px 20px #ff2f00,
                120px 10px #2bff00,
                -30px -50px #ff8800;
                transform: translate(0, 0);
            }
        }
        
        @keyframes gravity {
            to {
                transform: translateY(300px);
                opacity: 0;
            }
        }
        
        @keyframes position {
            0%, 14.9% {
                margin-top: 5%;
                margin-left: 20%;
            }
            15%, 29.9% {
                margin-top: 10%;
                margin-left: 40%;
            }
            30%, 44.9% {
                margin-top: 8%;
                margin-left: 60%;
            }
            45%, 59.9% {
                margin-top: 12%;
                margin-left: 30%;
            }
            60%, 74.9% {
                margin-top: 5%;
                margin-left: 70%;
            }
            75%, 89.9% {
                margin-top: 15%;
                margin-left: 50%;
            }
            90%, 99.9% {
                margin-top: 10%;
                margin-left: 20%;
            }
        }
        
        /* Sparkles animation */
        .sparkle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #fff;
            box-shadow: 0 0 10px 2px #ffeb3b, 0 0 20px 4px #ffeb3b;
            animation: sparkle 1.5s ease-in-out infinite;
            opacity: 0;
            z-index: 1000;
        }
        
        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }
        
        body {
            font-family: var(--font-primary);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
            font-weight: var(--font-weight-normal);
            letter-spacing: 0.015em;
        }

        h1, h2, h3 {
            font-weight: var(--font-weight-bold);
            margin-bottom: 1rem;
            letter-spacing: -0.01em;
        }

        h1 {
            font-size: 2.2rem;
        }

        h2 {
            font-size: 1.8rem;
        }

        .quiz-container {
            background-color: var(--container-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .question {
            font-size: 1.25rem;
            font-weight: var(--font-weight-bold);
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .options {
            margin-top: 15px;
        }
        .option {
            margin: 10px 0;
            padding: 14px 16px;
            background-color: var(--option-bg);
            border: 1px solid var(--option-border);
            border-radius: 8px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-color);
            font-size: 1.05rem;
            font-weight: var(--font-weight-medium);
            letter-spacing: 0.01em;
        }
        .option:hover {
            background-color: var(--option-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .result {
            font-weight: var(--font-weight-medium);
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            line-height: 1.6;
        }
        .correct {
            background-color: var(--correct-bg);
            color: var(--correct-color);
            border-left: 4px solid var(--correct-color);
        }
        .incorrect {
            background-color: var(--incorrect-bg);
            color: var(--incorrect-color);
            border-left: 4px solid var(--incorrect-color);
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            gap: 10px;
        }
        .nav-button {
            padding: 12px 18px;
            background-color: var(--button-bg);
            color: var(--button-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 0 5px;
            font-weight: var(--font-weight-medium);
            font-size: 1rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .nav-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .nav-button:disabled {
            background-color: var(--disabled-button);
            cursor: not-allowed;
            opacity: 0.7;
        }
        .skip-button {
            background-color: var(--skipped-color);
            color: #1e1e2e;
        }
        .try-again-button {
            background-color: #cba6f7;
            color: #1e1e2e;
        }
        .progress {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: var(--font-weight-medium);
        }
        .score-container {
            background-color: var(--score-container);
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border-left: 5px solid var(--button-bg);
        }
        .score {
            font-weight: var(--font-weight-bold);
            font-size: 1.1rem;
        }
        .correct-score {
            color: var(--correct-color);
        }
        .incorrect-score {
            color: var(--incorrect-color);
        }
        .skipped-score {
            color: var(--skipped-color);
        }
        .top-actions {
            display: flex;
            margin-bottom: 25px;
            gap: 12px;
            flex-wrap: wrap;
        }
        .action-button {
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            font-size: 1rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .restart-button {
            background-color: #f38ba8;
            color: #1e1e2e;
        }
        .review-button {
            background-color: #a6e3a1;
            color: #1e1e2e;
        }
        /* Congratulations Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-overlay);
            overflow: auto;
        }
        .modal-content {
            background-color: var(--modal-bg);
            margin: 10% auto;
            padding: 25px 30px;
            width: 80%;
            max-width: 600px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            animation: modalFadeIn 0.5s;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-color);
            transition: color 0.2s;
        }
        .close-modal:hover {
            color: var(--button-bg);
        }
        .modal h2 {
            color: var(--correct-color);
            margin-bottom: 20px;
            font-size: 2rem;
        }
        .modal p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .score-details {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
            gap: 15px;
        }
        .score-box {
            padding: 18px 15px;
            border-radius: 10px;
            width: 28%;
            font-weight: var(--font-weight-bold);
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }
        
        .score-box:hover {
            transform: translateY(-3px);
        }
        
        /* Enhanced score box labels */
        .score-box br {
            display: block;
            content: "";
            margin-top: 8px;
        }
        
        /* Score values */
        .score-box span {
            font-size: 2rem;
            font-weight: 700;
            display: block;
            margin-top: 8px;
        }
        
        /* Dark mode specific enhancements for score boxes */
        [data-theme="dark"] .score-box {
            color: #cdd6f4;
            text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(205, 214, 244, 0.1);
        }
        
        /* Specific score box colors and text colors */
        .correct-score-box {
            background-color: var(--correct-bg);
            color: var(--correct-color);
            border-top: 4px solid var(--correct-color);
        }
        
        .incorrect-score-box {
            background-color: var(--incorrect-bg);
            color: var(--incorrect-color);
            border-top: 4px solid var(--incorrect-color);
        }
        
        .skipped-score-box {
            background-color: #3f3223;
            color: var(--skipped-color);
            border-top: 4px solid var(--skipped-color);
        }
        
        .restart-quiz-btn {
            background-color: var(--button-bg);
            color: var(--button-color);
            padding: 14px 22px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-top: 25px;
            font-weight: var(--font-weight-medium);
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .restart-quiz-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        /* File upload styling */
        .upload-container {
            background-color: var(--score-container);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            border-left: 5px solid #89b4fa;
        }
        
        .upload-container h2 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .file-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .upload-btn, .sample-btn {
            background-color: #a6e3a1;
            color: #1e1e2e;
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            font-size: 1rem;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .upload-btn {
            background-color: #89b4fa;
        }
        .sample-btn {
            background-color: #a6e3a1;
        }
        
        .upload-btn:hover, .sample-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        }
        
        .hidden {
            display: none;
        }
        .json-sample {
            background-color: var(--json-sample-bg);
            padding: 18px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
            overflow-x: auto;
            max-height: 250px;
            overflow-y: auto;
            color: var(--text-color);
            border: 1px solid var(--option-border);
            font-family: var(--font-mono);
            font-size: 0.95rem;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
        }
        .error-message {
            color: var(--incorrect-color);
            font-weight: var(--font-weight-medium);
            margin: 12px 0;
            padding: 10px;
            background-color: var(--incorrect-bg);
            border-radius: 6px;
            border-left: 4px solid var(--incorrect-color);
        }
        
        /* Input method toggle */
        .input-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
        }
        .toggle-btn {
            background-color: var(--disabled-button);
            color: var(--text-color);
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            transition: all 0.2s;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        .toggle-btn.active {
            background-color: #a6e3a1;
            color: #1e1e2e;
        }
        
        .toggle-btn:hover {
            transform: translateY(-2px);
        }
        
        .json-input {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            border: 1px solid var(--option-border);
            border-radius: 8px;
            font-family: var(--font-mono);
            font-size: 0.95rem;
            resize: vertical;
            margin-bottom: 15px;
            background-color: var(--container-bg);
            color: var(--text-color);
            box-sizing: border-box;
            max-width: 100%;
            transition: border-color 0.2s;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .json-input:focus {
            border-color: var(--button-bg);
            outline: none;
            box-shadow: 0 0 0 2px rgba(137, 180, 250, 0.3);
        }
        
        .json-paste-container {
            margin-bottom: 20px;
            width: 100%;
        }
        .paste-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        .json-btn {
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            font-size: 1rem;
            transition: all 0.2s;
            background-color: var(--button-bg);
            color: var(--button-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        .json-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .clear-btn {
            background-color: #f38ba8;
        }
        
        /* Copy button styling */
        .sample-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 8px;
            gap: 8px;
        }
        .copy-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background-color: #cba6f7;
            color: #1e1e2e;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: var(--font-weight-medium);
            transition: all 0.2s;
        }
        .copy-btn:hover {
            background-color: #b4befe;
            transform: translateY(-2px);
        }
        .copy-success {
            background-color: #a6e3a1;
            transition: background-color 0.3s;
        }
        
        /* Add button styling for change quiz button */
        .change-quiz-btn {
            background-color: #cba6f7;
            color: #1e1e2e;
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            margin-right: 12px;
            font-size: 1rem;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        .change-quiz-btn:hover {
            background-color: #b4befe;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Animation for hide/show */
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Button icon styling */
        .btn-icon {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .btn-icon svg {
            width: 18px;
            height: 18px;
        }
        
        /* Timer styling */
        .timer-container {
            background-color: var(--option-bg);
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            border-left: 4px solid var(--button-bg);
        }
        
        .timer-display {
            font-size: 1.3rem;
            font-weight: var(--font-weight-bold);
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .timer-warning {
            color: #fab387;
        }
        
        .timer-danger {
            color: #f38ba8;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .timer-options {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1rem;
        }
        
        .timer-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: var(--font-weight-medium);
            font-size: 1.05rem;
        }

        .timer-label svg {
            width: 20px;
            height: 20px;
        }
        
        /* Dark mode toggle styling */
        .theme-toggle-container {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--container-bg);
            padding: 8px 12px;
            border-radius: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #45475a;
            transition: .4s;
            border-radius: 34px;
        }
        
        .theme-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: #f9f9fb;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        input:checked + .theme-slider {
            background-color: #89b4fa;
        }
        
        input:focus + .theme-slider {
            box-shadow: 0 0 1px #89b4fa;
        }
        
        input:checked + .theme-slider:before {
            transform: translateX(30px);
            background-color: #1e1e2e;
        }
        
        .theme-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px;
            width: 24px;
            color: var(--text-color);
        }
        
        select, option {
            background-color: var(--container-bg);
            color: var(--text-color);
            border: 1px solid var(--option-border);
            padding: 8px 12px;
            border-radius: 6px;
            font-family: var(--font-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        select:focus {
            outline: none;
            border-color: var(--button-bg);
            box-shadow: 0 0 0 2px rgba(137, 180, 250, 0.3);
        }

        /* Modern scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--container-bg);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--option-border);
            border-radius: 8px;
            border: 3px solid var(--container-bg);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--button-bg);
        }
        
        /* Apply modern fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
        
        /* Other elements styling improvements */
        #file-name {
            font-weight: var(--font-weight-medium);
            padding: 6px 10px;
            background-color: var(--container-bg);
            border-radius: 6px;
            display: inline-block;
            margin-top: 5px;
        }
        
        /* Toggle switch for timer */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #45475a;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: #f9f9fb;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #a6e3a1;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* Add new styles for selected answers */
        .option.correct-answer {
            background-color: var(--correct-bg) !important;
            color: var(--correct-color) !important;
            border: 2px solid var(--correct-color) !important;
            font-weight: var(--font-weight-bold);
            box-shadow: 0 0 0 1px var(--correct-color);
        }

        .option.incorrect-answer {
            background-color: var(--incorrect-bg) !important;
            color: var(--incorrect-color) !important;
            border: 2px solid var(--incorrect-color) !important;
            font-weight: var(--font-weight-bold);
            box-shadow: 0 0 0 1px var(--incorrect-color);
        }

        .option.user-selected {
            position: relative;
            padding-right: 40px;
        }

        .option.user-selected::after {
            content: "✓";
            position: absolute;
            right: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .option.correct-answer.user-selected::after {
            content: "✓";
            color: var(--correct-color);
        }

        .option.incorrect-answer.user-selected::after {
            content: "✗";
            color: var(--incorrect-color);
        }

        /* Enhanced visibility for dark mode */
        [data-theme="dark"] .option.correct-answer {
            background-color: rgba(166, 227, 161, 0.25) !important;
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.5);
        }

        [data-theme="dark"] .option.incorrect-answer {
            background-color: rgba(243, 139, 168, 0.25) !important;
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.5);
        }

        /* Enhanced styles for result messages with stronger contrast */
        [data-theme="dark"] .result {
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .result span.correct,
        [data-theme="dark"] .result span.incorrect {
            font-size: 1.1rem;
            font-weight: var(--font-weight-bold);
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 10px;
        }

        [data-theme="dark"] .result span.correct {
            background-color: rgba(166, 227, 161, 0.2);
            color: var(--correct-color);
        }

        [data-theme="dark"] .result span.incorrect {
            background-color: rgba(243, 139, 168, 0.2);
            color: var(--incorrect-color);
        }

        /* Tutorial overlay styling */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .tutorial-container {
            width: 90%;
            max-width: 600px;
            background-color: var(--modal-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .tutorial-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-height: 80vh;
            overflow-y: auto;
            gap: 20px;
        }
        
        .tutorial-step {
            display: none;
            text-align: center;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .tutorial-step.active {
            display: block;
        }
        
        .tutorial-image {
            width: 100%;
            max-width: 400px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            width: 100%;
        }
        
        .tutorial-nav-button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background-color: var(--button-bg);
            color: var(--button-color);
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .tutorial-nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .tutorial-nav-button:disabled {
            background-color: var(--disabled-button);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .tutorial-progress {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .tutorial-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--option-border);
            transition: all 0.2s ease;
        }
        
        .tutorial-dot.active {
            background-color: var(--button-bg);
            transform: scale(1.2);
        }
        
        .skip-tutorial {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .skip-tutorial:hover {
            opacity: 1;
        }
        
        .tutorial-tip {
            background-color: var(--option-bg);
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid var(--button-bg);
            margin: 15px 0;
            text-align: left;
        }
        
        .no-tutorial-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        /* Help button styling */
        .help-button-container {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 900;
        }
        
        .help-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--button-bg);
            color: var(--button-color);
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .help-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* Add these media queries at the end of the existing styles */

        /* General mobile responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .quiz-container, .upload-container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .option {
                padding: 12px;
                font-size: 1rem;
            }

            .nav-button, .action-button {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .score-container {
                flex-wrap: wrap;
                gap: 10px;
            }

            .score {
                width: 45%;
                text-align: center;
            }

            .navigation {
                flex-wrap: wrap;
                gap: 8px;
            }

            .nav-button {
                flex: 1 1 45%;
            }

            .top-actions {
                gap: 8px;
            }

            .action-button {
                flex: 1 1 45%;
            }

            .theme-toggle-container {
                top: 15px;
                right: 15px;
                padding: 6px 10px;
            }

            .help-button-container {
                bottom: 15px;
                right: 15px;
            }

            .help-button {
                width: 40px;
                height: 40px;
            }

            .timer-container {
                flex-direction: column;
                gap: 10px;
            }

            .timer-options {
                flex-direction: column;
                gap: 8px;
            }

            .input-toggle {
                flex-wrap: wrap;
            }

            .toggle-btn {
                flex: 1 1 100%;
                margin-bottom: 8px;
            }

            .json-input {
                min-height: 150px;
            }

            .modal-content {
                width: 90%;
                margin: 20% auto;
                padding: 20px;
            }

            .score-details {
                flex-direction: column;
                gap: 10px;
            }

            .score-box {
                width: 100%;
            }
        }

        /* Small mobile devices */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.6rem;
            }

            h2 {
                font-size: 1.3rem;
            }

            .option {
                padding: 10px;
                font-size: 0.95rem;
            }

            .nav-button, .action-button {
                padding: 8px 10px;
                font-size: 0.85rem;
            }

            .score {
                width: 100%;
            }

            .nav-button {
                flex: 1 1 100%;
            }

            .action-button {
                flex: 1 1 100%;
            }

            .theme-toggle-container {
                position: static;
                margin: 10px 0;
                justify-content: center;
            }

            .help-button-container {
                bottom: 10px;
                right: 10px;
            }

            .help-button {
                width: 36px;
                height: 36px;
            }

            .json-input {
                min-height: 120px;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 15px;
            }

            /* Add space between view and download template buttons */
            #sample-button, #download-sample {
                margin: 5px;
            }
        }

        /* Landscape orientation */
        @media (max-width: 768px) and (orientation: landscape) {
            body {
                padding: 5px;
            }

            .quiz-container, .upload-container {
                padding: 10px;
            }

            .option {
                padding: 8px;
            }

            .nav-button, .action-button {
                padding: 6px 8px;
            }

            .score-container {
                gap: 5px;
            }

            .navigation {
                gap: 5px;
            }

            .top-actions {
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Tutorial Overlay -->
    <div id="tutorial-overlay" class="tutorial-overlay">
        <div class="tutorial-container">
            <button id="skip-tutorial" class="skip-tutorial">✕</button>
            <div class="tutorial-content">
                <div class="tutorial-step active" data-step="1">
                    <h2>Welcome to Interactive Quiz!</h2>
                    <p>This quick tutorial will help you get started with the app.</p>
                    <div class="tutorial-tip">
                        <strong>Tip:</strong> You can always revisit this tutorial from the help menu later.
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="2">
                    <h2>Start with Your Quiz</h2>
                    <p>Generate quizzes on any topic using AI services, as per the provided JSON sample format. Then, paste the generated JSON directly or upload it as a file.</p>
                    <div class="tutorial-tip">
                        <strong>Tip:</strong> Try the sample quiz first to see how everything works!
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="3">
                    <h2>Answering Questions</h2>
                    <p>Select the correct option from the multiple choices. The app will immediately show you if your answer is correct.</p>
                    <div class="tutorial-tip">
                        <strong>Tip:</strong> You can retry a question if you get it wrong or skip if you're not sure.
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="4">
                    <h2>Track Your Progress</h2>
                    <p>The score tracker at the top shows your correct, incorrect, and skipped answers.</p>
                    <div class="tutorial-tip">
                        <strong>Tip:</strong> You can use the navigation buttons to move between questions.
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="5">
                    <h2>Dark Mode & Timer</h2>
                    <p>Toggle dark mode for night reading and use the timer to challenge yourself!</p>
                    <div class="tutorial-tip">
                        <strong>Tip:</strong> You can disable the timer if you prefer to take your time.
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="6">
                    <h2>Ready to Begin!</h2>
                    <p>You're all set to start quizzing! Click "Finish Tutorial" to begin.</p>
                    <div class="no-tutorial-checkbox">
                        <input type="checkbox" id="no-tutorial-again">
                        <label for="no-tutorial-again">Don't show this tutorial again</label>
                    </div>
                </div>
            </div>
            
            <div class="tutorial-progress">
                <span class="tutorial-dot active" data-step="1"></span>
                <span class="tutorial-dot" data-step="2"></span>
                <span class="tutorial-dot" data-step="3"></span>
                <span class="tutorial-dot" data-step="4"></span>
                <span class="tutorial-dot" data-step="5"></span>
                <span class="tutorial-dot" data-step="6"></span>
            </div>
            
            <div class="tutorial-navigation">
                <button id="prev-tutorial" class="tutorial-nav-button" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                    </svg>
                    Previous
                </button>
                <button id="next-tutorial" class="tutorial-nav-button">
                    Next
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Help Button -->
    <div class="help-button-container">
        <button id="help-button" class="help-button" title="Show Tutorial">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
            </svg>
        </button>
    </div>
    
    <!-- Dark mode toggle switch -->
    <div class="theme-toggle-container">
        <div class="theme-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
            </svg>
        </div>
        <label class="theme-toggle">
            <input type="checkbox" id="theme-toggle-switch">
            <span class="theme-slider"></span>
        </label>
        <div class="theme-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
            </svg>
        </div>
    </div>
    
    <h1 id="quiz-heading">Interactive Quiz</h1>
    
    <div id="upload-section" class="upload-container">
        <h2>Upload Quiz Data</h2>
        
        <!-- Timer Settings -->
        <div class="timer-container">
            <div class="timer-toggle">
                <label class="toggle-switch">
                    <input type="checkbox" id="timer-toggle-switch">
                    <span class="slider"></span>
                </label>
                <span class="timer-label">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42A8.962 8.962 0 0012 4c-4.97 0-9 4.03-9 9s4.02 9 9 9a8.994 8.994 0 007.03-14.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>
                    </svg>
                    Enable Timer
                </span>
            </div>
            <div class="timer-options" id="timer-options" style="display: none;">
                <label for="timer-duration">Duration:</label>
                <select id="timer-duration">
                    <option value="5">5 minutes</option>
                    <option value="10">10 minutes</option>
                    <option value="15">15 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="45">45 minutes</option>
                    <option value="60">1 hour</option>
                    <option value="90">1.5 hours</option>
                    <option value="120">2 hours</option>
                    <option value="180">3 hours</option>
                </select>
            </div>
        </div>
        
        <div class="input-toggle">
            <button id="upload-toggle" class="toggle-btn active btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
                    <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"></path>
                </svg>
                Upload File
            </button>
            <button id="paste-toggle" class="toggle-btn btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 1.99 2H18c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1-1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"></path>
                </svg>
                Paste JSON
            </button>
        </div>
        
        <!-- File Upload Option -->
        <div id="file-upload-container" class="file-upload">
            <input type="file" id="quiz-file" accept=".json" class="hidden">
            <button id="upload-button" class="upload-btn btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"></path>
                </svg>
                Import Quiz File
            </button>
            <span id="file-name">No file selected</span>
        </div>
        
        <!-- JSON Paste Option -->
        <div id="json-paste-container" class="json-paste-container" style="display: none;">
            <textarea id="json-input" class="json-input" placeholder="Paste your quiz JSON here..."></textarea>
            <div class="paste-actions">
                <button id="load-json-btn" class="json-btn btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 16c-2.05 0-3.81-1.24-4.58-3h1.71c.63.9 1.68 1.5 2.87 1.5 1.93 0 3.5-1.57 3.5-3.5S13.93 9.5 12 9.5c-1.35 0-2.52.78-3.1 1.9l1.6 1.6h-4V9l1.3 1.3C8.69 8.92 10.23 8 12 8c2.76 0 5 2.24 5 5s-2.24 5-5 5z"></path>
                    </svg>
                    Parse JSON
                </button>
                <button id="clear-json-btn" class="json-btn clear-btn btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
                    </svg>
                    Clear
                </button>
            </div>
        </div>
        
        <div id="error-message" class="error-message" style="display: none;"></div>
        
        <div style="margin-top: 15px;">
            <button id="sample-button" class="sample-btn btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"></path>
                </svg>
                View Template
            </button>
            <button id="download-sample" class="sample-btn btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path>
                </svg>
                Download Template
            </button>
            <div id="json-sample" class="json-sample" style="display: none;">
                <div class="sample-actions">
                    <button id="copy-sample" class="copy-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                        </svg>
                        Copy JSON
                    </button>
                </div>
                <pre id="sample-content"></pre>
            </div>
        </div>
    </div>
    
    <div id="quiz-content" style="display: none;">
        <div class="top-actions">
            <button id="change-quiz-button" class="change-quiz-btn btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L11 13.17l6.59-6.59L19 8l-7 7z"></path>
                </svg>
                Switch Quiz
            </button>
            <button id="restart-button" class="action-button restart-button btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
                </svg>
                Reset
            </button>
            <button id="review-button" class="action-button review-button btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z"></path>
                </svg>
                Review Errors
            </button>
        </div>
        
        <!-- Timer display -->
        <div class="timer-container" id="quiz-timer" style="display: none;">
            <div class="timer-display">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42A8.962 8.962 0 0012 4c-4.97 0-9 4.03-9 9s4.02 9 9 9a8.994 8.994 0 007.03-14.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>
                </svg>
                <span id="time-remaining">00:00</span>
            </div>
        </div>
        
        <div class="score-container">
            <div class="score correct-score">Correct: <span id="correct-count">0</span></div>
            <div class="score skipped-score">Skipped: <span id="skipped-count">0</span></div>
            <div class="score">Total Answered: <span id="total-answered">0</span>/<span id="total-questions">0</span></div>
            <div class="score incorrect-score">Incorrect: <span id="incorrect-count">0</span></div>
        </div>
        
        <div class="progress">Question <span id="current-question">1</span> of <span id="question-count">0</span></div>
        <div id="quiz-container" class="quiz-container">
            <div class="question" id="question"></div>
            <div class="options" id="options-container"></div>
            <div id="feedback" class="result" style="display: none;"></div>
        </div>
        <div class="navigation">
            <button id="prev-button" class="nav-button btn-icon" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                </svg>
                Previous
            </button>
            <button id="skip-button" class="nav-button skip-button btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18 6.83L16.59 5.41 12 10l-4.59-4.59L6 6.83 10.59 11.5 6 16.17l1.41 1.42L12 13l4.59 4.59L18 16.17l-4.59-4.67z"></path>
                </svg>
                Skip
            </button>
            <button id="try-again-button" class="nav-button try-again-button btn-icon" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
                </svg>
                Retry
            </button>
            <button id="next-button" class="nav-button btn-icon" disabled>
                Next
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Congratulations Modal -->
    <div id="congratulations-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal-btn">&times;</span>
            <h2>Quiz Complete! 🎉</h2>
            <p>You've finished the quiz!</p>
            
            <div class="score-details">
                <div class="score-box correct-score-box">
                    Correct<br><span id="final-correct">0</span>
                </div>
                <div class="score-box incorrect-score-box">
                    Incorrect<br><span id="final-incorrect">0</span>
                </div>
                <div class="score-box skipped-score-box">
                    Skipped<br><span id="final-skipped">0</span>
                </div>
            </div>
            
            <p id="performance-message">Well done!</p>
            
            <button class="restart-quiz-btn btn-icon" id="restart-quiz-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
                </svg>
                Start New Attempt
            </button>
        </div>
    </div>
    
    <!-- Fireworks -->
    <div class="pyro" id="fireworks" style="display: none;">
        <div class="before"></div>
        <div class="after"></div>
    </div>

    <script>
        // Dark mode functionality
        // Apply light mode as default immediately
        document.documentElement.setAttribute('data-theme', 'light');
        
        document.addEventListener('DOMContentLoaded', () => {
            // Tutorial functionality
            const tutorialOverlay = document.getElementById('tutorial-overlay');
            const skipTutorialBtn = document.getElementById('skip-tutorial');
            const prevTutorialBtn = document.getElementById('prev-tutorial');
            const nextTutorialBtn = document.getElementById('next-tutorial');
            const tutorialSteps = document.querySelectorAll('.tutorial-step');
            const tutorialDots = document.querySelectorAll('.tutorial-dot');
            const noTutorialAgain = document.getElementById('no-tutorial-again');
            const helpButton = document.getElementById('help-button');
            
            let currentStep = 1;
            const totalSteps = tutorialSteps.length;
            
            // Check if user has seen the tutorial before
            const tutorialSeen = localStorage.getItem('tutorial-seen');
            
            // Show tutorial if first visit
            if (!tutorialSeen) {
                showTutorial();
            }
            
            // Help button shows the tutorial
            helpButton.addEventListener('click', showTutorial);
            
            function showTutorial() {
                tutorialOverlay.style.display = 'flex';
                updateTutorialUI();
            }
            
            function hideTutorial() {
                tutorialOverlay.style.display = 'none';
                
                // Save preference if checkbox is checked
                if (noTutorialAgain.checked) {
                    localStorage.setItem('tutorial-seen', 'true');
                } else {
                    // Mark as seen but allow showing again
                    localStorage.setItem('tutorial-seen', 'viewed');
                }
            }
            
            function updateTutorialUI() {
                // Hide all steps
                tutorialSteps.forEach(step => {
                    step.classList.remove('active');
                });
                
                // Show current step
                document.querySelector(`.tutorial-step[data-step="${currentStep}"]`).classList.add('active');
                
                // Update dots
                tutorialDots.forEach(dot => {
                    dot.classList.remove('active');
                });
                document.querySelector(`.tutorial-dot[data-step="${currentStep}"]`).classList.add('active');
                
                // Update buttons
                prevTutorialBtn.disabled = currentStep === 1;
                
                if (currentStep === totalSteps) {
                    nextTutorialBtn.textContent = 'Finish Tutorial';
                } else {
                    nextTutorialBtn.innerHTML = `Next <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg>`;
                }
            }
            
            // Navigation buttons
            prevTutorialBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateTutorialUI();
                }
            });
            
            nextTutorialBtn.addEventListener('click', () => {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateTutorialUI();
                } else {
                    hideTutorial();
                }
            });
            
            // Skip tutorial
            skipTutorialBtn.addEventListener('click', hideTutorial);
            
            // Clicking on dots
            tutorialDots.forEach(dot => {
                dot.addEventListener('click', () => {
                    currentStep = parseInt(dot.getAttribute('data-step'));
                    updateTutorialUI();
                });
            });
            
            // Interactive tutorial elements
            // Add listeners for tutorial dots
            document.querySelectorAll('.tutorial-dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    const stepNumber = parseInt(dot.getAttribute('data-step'));
                    currentStep = stepNumber;
                    updateTutorialUI();
                });
            });
            
            // Dark mode functionality
            const themeToggle = document.getElementById('theme-toggle-switch');
            
            // Check for saved theme preference or use light mode as default
            const savedTheme = localStorage.getItem('theme');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.checked = true;
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                themeToggle.checked = false;
            }
            
            // Toggle theme when switch is clicked
            themeToggle.addEventListener('change', () => {
                if (themeToggle.checked) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }
            });
        });
      
        // Default quiz data structure
        let quizData = {
            title: "Interactive Quiz",
            heading: "Interactive Quiz",
            questions: []
        };
        
        const sampleQuizData = {
            title: "Computer Science Basics Quiz",
            heading: "Test Your CS Knowledge",
            questions: [
                {
                    question: "What does CPU stand for?",
                    options: [
                        "A. Central Processing Unit",
                        "B. Computer Processing Unit",
                        "C. Central Processor Unit",
                        "D. Core Processing Unit"
                    ],
                    correctAnswer: "A",
                    explanation: "CPU stands for Central Processing Unit. It is the primary component of a computer that performs most of the processing inside a computer."
                },
                {
                    question: "Which of the following is not a programming language?",
                    options: [
                        "A. Java",
                        "B. HTML",
                        "C. Python",
                        "D. Linux"
                    ],
                    correctAnswer: "D",
                    explanation: "Linux is an operating system, not a programming language. Java, HTML, and Python are all programming or markup languages."
                },
                {
                    question: "What does HTTP stand for?",
                    options: [
                        "A. Hypertext Transfer Protocol",
                        "B. Hypertext Transit Protocol",
                        "C. Hyper Transfer Text Protocol",
                        "D. High-Level Transfer Protocol"
                    ],
                    correctAnswer: "A",
                    explanation: "HTTP stands for Hypertext Transfer Protocol, which is the foundation of data communication on the World Wide Web."
                },
                {
                    question: "Which data structure operates on a Last In, First Out (LIFO) principle?",
                    options: [
                        "A. Queue",
                        "B. Stack",
                        "C. Linked List",
                        "D. Tree"
                    ],
                    correctAnswer: "B",
                    explanation: "A Stack follows the Last In, First Out (LIFO) principle, where the last element added is the first one to be removed."
                },
                {
                    question: "Which of the following is a valid IP address?",
                    options: [
                        "A. 192.168.1.256",
                        "B. 172.16.254.1",
                        "C. 256.256.256.256",
                        "D. 10.0.0.1000"
                    ],
                    correctAnswer: "B",
                    explanation: "172.16.254.1 is a valid IP address. In IPv4, each segment must be between 0 and 255."
                }
            ]
        };
        
        let currentQuestionIndex = 0;
        let answeredQuestions = [];
        let skippedQuestions = [];
        let userAnswers = [];
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let skippedCount = 0;
        let incorrectQuestionIndices = [];
        
        // Timer variables
        let timerEnabled = false;
        let timerDuration = 5; // default 5 minutes
        let timeRemaining = 0;
        let timerInterval = null;
        
        // Function to initialize the quiz with provided data
        function initializeQuiz(data) {
            // Set title and heading
            document.getElementById("page-title").textContent = data.title;
            document.getElementById("quiz-heading").textContent = data.heading;
            
            // Update question count
            document.getElementById("question-count").textContent = data.questions.length;
            document.getElementById("total-questions").textContent = data.questions.length;
            
            // Initialize arrays
            answeredQuestions = new Array(data.questions.length).fill(false);
            skippedQuestions = new Array(data.questions.length).fill(false);
            userAnswers = new Array(data.questions.length).fill(null);
            
            // Display first question
            displayQuestion(0);
        }
        
        // Toggle between file upload and JSON paste
        function toggleInputMethod(method) {
            const uploadToggle = document.getElementById('upload-toggle');
            const pasteToggle = document.getElementById('paste-toggle');
            const fileUploadContainer = document.getElementById('file-upload-container');
            const jsonPasteContainer = document.getElementById('json-paste-container');
            
            if (method === 'upload') {
                uploadToggle.classList.add('active');
                pasteToggle.classList.remove('active');
                fileUploadContainer.style.display = 'flex';
                jsonPasteContainer.style.display = 'none';
            } else {
                uploadToggle.classList.remove('active');
                pasteToggle.classList.add('active');
                fileUploadContainer.style.display = 'none';
                jsonPasteContainer.style.display = 'block';
            }
            
            // Clear any previous error messages
            document.getElementById('error-message').style.display = 'none';
        }
        
        // Process pasted JSON
        function processPastedJson() {
            const jsonInput = document.getElementById('json-input');
            const errorMsg = document.getElementById('error-message');
            
            errorMsg.style.display = 'none';
            
            if (jsonInput.value.trim() === '') {
                errorMsg.textContent = 'Error: Please paste JSON content before loading';
                errorMsg.style.display = 'block';
                return;
            }
            
            // Use the common processQuizData function instead of duplicating logic
            processQuizData(jsonInput.value);
        }
        
        // Clear JSON input
        function clearJsonInput() {
            document.getElementById('json-input').value = '';
            document.getElementById('error-message').style.display = 'none';
        }
        
        // Fill the JSON input with sample data
        function fillSampleJson() {
            document.getElementById('json-input').value = JSON.stringify(sampleQuizData, null, 2);
        }
        
        // File handling functions
        function handleFileSelect(event) {
            const fileInput = document.getElementById('quiz-file');
            const fileNameSpan = document.getElementById('file-name');
            const errorMsg = document.getElementById('error-message');
            
            errorMsg.style.display = 'none';
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileNameSpan.textContent = file.name;
                
                // Read the file
                const reader = new FileReader();
                reader.onload = function(e) {
                    processQuizData(e.target.result);
                };
                reader.onerror = function() {
                    errorMsg.textContent = 'Error reading file';
                    errorMsg.style.display = 'block';
                };
                reader.readAsText(file);
            }
        }
        
        // Process quiz data from either file or pasted JSON
        function processQuizData(jsonString) {
            const errorMsg = document.getElementById('error-message');
            
            try {
                const data = JSON.parse(jsonString);
                validateQuizData(data);
                
                // If valid, use this data
                quizData = data;
                
                // Hide upload section
                document.getElementById('upload-section').style.display = 'none';
                
                // Show quiz content
                document.getElementById('quiz-content').style.display = 'block';
                document.getElementById('quiz-content').classList.add('fade-in');
                
                // Initialize quiz with the loaded data
                initializeQuiz(quizData);
                restartQuiz();
                
                // Start timer if enabled
                if (timerEnabled) {
                    startTimer();
                }
            } catch (error) {
                errorMsg.textContent = `Error: ${error.message}`;
                errorMsg.style.display = 'block';
            }
        }
        
        function validateQuizData(data) {
            // Check required fields
            if (!data.title) throw new Error("Quiz title is required");
            if (!data.heading) throw new Error("Quiz heading is required");
            if (!data.questions || !Array.isArray(data.questions)) 
                throw new Error("Questions must be an array");
            if (data.questions.length === 0) 
                throw new Error("At least one question is required");
            
            // Validate each question
            data.questions.forEach((q, index) => {
                if (!q.question) throw new Error(`Question ${index+1} text is missing`);
                if (!q.options || !Array.isArray(q.options) || q.options.length < 2) 
                    throw new Error(`Question ${index+1} must have at least 2 options`);
                if (!q.correctAnswer) 
                    throw new Error(`Question ${index+1} is missing the correct answer`);
                
                // Check if correctAnswer is valid (must be one of the option's first letters)
                const validAnswers = q.options.map(opt => opt.charAt(0));
                if (!validAnswers.includes(q.correctAnswer))
                    throw new Error(`Question ${index+1} has an invalid correct answer`);
            });
        }
        
        function toggleSampleDisplay() {
            const jsonSample = document.getElementById('json-sample');
            const sampleContent = document.getElementById('sample-content');
            
            if (jsonSample.style.display === 'none') {
                jsonSample.style.display = 'block';
                sampleContent.textContent = JSON.stringify(sampleQuizData, null, 2);
            } else {
                jsonSample.style.display = 'none';
            }
        }
        
        function copySampleToClipboard() {
            const sampleContent = document.getElementById('sample-content').textContent;
            const copyButton = document.getElementById('copy-sample');
            
            // Use the Clipboard API to copy text
            navigator.clipboard.writeText(sampleContent)
                .then(() => {
                    // Visual feedback - show success state
                    const originalText = copyButton.innerHTML;
                    copyButton.classList.add('copy-success');
                    copyButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                        </svg>
                        Copied!
                    `;
                    
                    // Reset after 2 seconds
                    setTimeout(() => {
                        copyButton.innerHTML = originalText;
                        copyButton.classList.remove('copy-success');
                    }, 2000);
                })
                .catch(err => {
                    console.error('Could not copy text: ', err);
                    alert('Failed to copy to clipboard');
                });
        }
        
        function downloadSampleJSON() {
            const dataStr = JSON.stringify(sampleQuizData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = 'quiz_sample.json';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            URL.revokeObjectURL(url);
        }
        
        // Existing functions
        function displayQuestion(index) {
            const questionElement = document.getElementById("question");
            const optionsContainer = document.getElementById("options-container");
            const feedbackElement = document.getElementById("feedback");
            const currentQuestion = document.getElementById("current-question");
            const skipButton = document.getElementById("skip-button");
            const tryAgainButton = document.getElementById("try-again-button");
            
            // Update question number
            currentQuestion.textContent = index + 1;
            
            // Display question
            questionElement.textContent = quizData.questions[index].question;
            
            // Clear previous options
            optionsContainer.innerHTML = "";
            
            // Create option buttons
            quizData.questions[index].options.forEach((option, i) => {
                const button = document.createElement("button");
                button.className = "option";
                button.textContent = option;
                
                // If question was already answered, disable the button
                if (answeredQuestions[index] && !skippedQuestions[index]) {
                    button.disabled = true;
                    // Highlight the selected answer and correct answer using classes
                    if (option.charAt(0) === userAnswers[index]) {
                        button.classList.add("user-selected");
                        if (userAnswers[index] === quizData.questions[index].correctAnswer) {
                            button.classList.add("correct-answer");
                        } else {
                            button.classList.add("incorrect-answer");
                        }
                    }
                    // Always highlight the correct answer
                    if (option.charAt(0) === quizData.questions[index].correctAnswer) {
                        button.classList.add("correct-answer");
                    }
                } else {
                    button.onclick = function() {
                        checkAnswer(option.charAt(0));
                    };
                }
                
                optionsContainer.appendChild(button);
            });
            
            // Show or hide feedback
            if (answeredQuestions[index] && !skippedQuestions[index]) {
                feedbackElement.style.display = "block";
                if (userAnswers[index] === quizData.questions[index].correctAnswer) {
                    feedbackElement.innerHTML = `<span class="correct">Correct!</span><br>${quizData.questions[index].explanation}`;
                    feedbackElement.className = "result correct";
                    tryAgainButton.style.display = "none";
                } else {
                    feedbackElement.innerHTML = `<span class="incorrect">Incorrect!</span> The correct answer is ${quizData.questions[index].correctAnswer}.<br>${quizData.questions[index].explanation}`;
                    feedbackElement.className = "result incorrect";
                    tryAgainButton.style.display = "inline-block";
                }
            } else {
                feedbackElement.style.display = "none";
                tryAgainButton.style.display = "none";
            }
            
            // Update button states
            document.getElementById("prev-button").disabled = (index === 0);
            document.getElementById("next-button").disabled = (!answeredQuestions[index] && !skippedQuestions[index]) && (index < quizData.questions.length - 1);
            
            // Show/hide skip button
            skipButton.style.display = (answeredQuestions[index] || skippedQuestions[index]) ? "none" : "inline-block";
            
            // Check if all questions are answered or skipped
            checkQuizCompletion();
        }

        function checkAnswer(selected) {
            const feedbackElement = document.getElementById("feedback");
            const currentQ = quizData.questions[currentQuestionIndex];
            const tryAgainButton = document.getElementById("try-again-button");
            const skipButton = document.getElementById("skip-button");
            
            // Store user's answer
            userAnswers[currentQuestionIndex] = selected;
            
            // Check if answer is correct
            if (selected === currentQ.correctAnswer) {
                feedbackElement.innerHTML = `<span class="correct">Correct!</span><br>${currentQ.explanation}`;
                feedbackElement.className = "result correct";
                
                // If this was previously an incorrect answer, update counts
                if (incorrectQuestionIndices.includes(currentQuestionIndex)) {
                    incorrectAnswers--;
                    correctAnswers++;
                    // Remove from incorrect list
                    incorrectQuestionIndices = incorrectQuestionIndices.filter(idx => idx !== currentQuestionIndex);
                }
                // If this was previously skipped, update counts
                else if (skippedQuestions[currentQuestionIndex]) {
                    skippedCount--;
                    correctAnswers++;
                    skippedQuestions[currentQuestionIndex] = false;
                }
                // Fresh correct answer
                else {
                    correctAnswers++;
                }
                
                tryAgainButton.style.display = "none";
            } else {
                feedbackElement.innerHTML = `<span class="incorrect">Incorrect!</span> The correct answer is ${currentQ.correctAnswer}.<br>${currentQ.explanation}`;
                feedbackElement.className = "result incorrect";
                
                // If this is a fresh incorrect answer
                if (!answeredQuestions[currentQuestionIndex] && !skippedQuestions[currentQuestionIndex]) {
                    incorrectAnswers++;
                    incorrectQuestionIndices.push(currentQuestionIndex);
                }
                // If this was previously skipped, update counts
                else if (skippedQuestions[currentQuestionIndex]) {
                    skippedCount--;
                    incorrectAnswers++;
                    skippedQuestions[currentQuestionIndex] = false;
                    incorrectQuestionIndices.push(currentQuestionIndex);
                }
                
                tryAgainButton.style.display = "inline-block";
            }
            
            // Show feedback
            feedbackElement.style.display = "block";
            
            // Mark question as answered
            answeredQuestions[currentQuestionIndex] = true;
            
            // Update score display
            updateScore();
            
            // Enable next button
            document.getElementById("next-button").disabled = (currentQuestionIndex === quizData.questions.length - 1);
            
            // Hide skip button
            skipButton.style.display = "none";
            
            // Apply classes to options instead of using inline styles
            const options = document.querySelectorAll(".option");
            options.forEach(option => {
                option.disabled = true;
                const optionLetter = option.textContent.charAt(0);
                
                if (optionLetter === selected) {
                    option.classList.add("user-selected");
                    if (selected === currentQ.correctAnswer) {
                        option.classList.add("correct-answer");
                    } else {
                        option.classList.add("incorrect-answer");
                    }
                }
                
                if (optionLetter === currentQ.correctAnswer) {
                    option.classList.add("correct-answer");
                }
            });
            
            // Check if all questions are answered or skipped
            checkQuizCompletion();
        }

        function skipQuestion() {
            // Only skip if not already answered or skipped
            if (!answeredQuestions[currentQuestionIndex] && !skippedQuestions[currentQuestionIndex]) {
                skippedQuestions[currentQuestionIndex] = true;
                skippedCount++;
                updateScore();
            }
            
            // Move to next question if possible
            if (currentQuestionIndex < quizData.questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
            } else {
                // Enable review if at the last question
                document.getElementById("next-button").disabled = true;
                
                // Check if all questions are answered or skipped
                checkQuizCompletion();
            }
        }

        function tryAgain() {
            // Reset this question
            answeredQuestions[currentQuestionIndex] = false;
            
            // If it was previously marked incorrect, update counter
            if (userAnswers[currentQuestionIndex] !== quizData.questions[currentQuestionIndex].correctAnswer) {
                incorrectAnswers--;
                // Remove from incorrect list if it's there
                incorrectQuestionIndices = incorrectQuestionIndices.filter(idx => idx !== currentQuestionIndex);
            }
            
            userAnswers[currentQuestionIndex] = null;
            updateScore();
            
            // Redisplay the question
            displayQuestion(currentQuestionIndex);
        }

        function updateScore() {
            document.getElementById("correct-count").textContent = correctAnswers;
            document.getElementById("incorrect-count").textContent = incorrectAnswers;
            document.getElementById("skipped-count").textContent = skippedCount;
            document.getElementById("total-answered").textContent = correctAnswers + incorrectAnswers;
        }

        function nextQuestion() {
            if (currentQuestionIndex < quizData.questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex);
            }
        }

        function restartQuiz() {
            // Hide modal if it's open
            document.getElementById('congratulations-modal').style.display = 'none';
            
            // Clean up fireworks properly
            hideFireworks();
            
            // Reset all variables
            currentQuestionIndex = 0;
            answeredQuestions = new Array(quizData.questions.length).fill(false);
            skippedQuestions = new Array(quizData.questions.length).fill(false);
            userAnswers = new Array(quizData.questions.length).fill(null);
            correctAnswers = 0;
            incorrectAnswers = 0;
            skippedCount = 0;
            incorrectQuestionIndices = [];
            
            // Update score display
            updateScore();
            
            // Display first question
            displayQuestion(currentQuestionIndex);
            
            // Restart timer if enabled
            if (timerEnabled) {
                startTimer();
            }
        }

        function reviewWrongAnswers() {
            // Only proceed if there are incorrect answers
            if (incorrectQuestionIndices.length > 0) {
                // Go to the first incorrect answer
                currentQuestionIndex = incorrectQuestionIndices[0];
                displayQuestion(currentQuestionIndex);
            } else {
                alert("No incorrect answers to review!");
            }
        }
        
        function checkQuizCompletion() {
            // Check if all questions have been answered or skipped
            const allAnswered = answeredQuestions.every((answered, index) => answered || skippedQuestions[index]);
            
            if (allAnswered) {
                // Check if complete button already exists
                const existingCompleteButton = document.querySelector('.complete-quiz-button');
                if (!existingCompleteButton) {
                    // Show complete button instead of auto-showing results
                    const completeButton = document.createElement('button');
                    completeButton.className = 'nav-button btn-icon complete-quiz-button';
                    completeButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                        </svg>
                        Complete Quiz
                    `;
                    completeButton.style.backgroundColor = '#4CAF50';
                    completeButton.style.margin = '20px auto';
                    completeButton.style.display = 'block';
                    completeButton.onclick = showCongratulations;
                    
                    // Add the button to the navigation section
                    const navigation = document.querySelector('.navigation');
                    navigation.appendChild(completeButton);
                }
            }
        }
        
        function showCongratulations() {
            // Stop the timer if it's running
            stopTimer();
            
            // Update final score in modal
            document.getElementById("final-correct").textContent = correctAnswers;
            document.getElementById("final-incorrect").textContent = incorrectAnswers;
            document.getElementById("final-skipped").textContent = skippedCount;
            
            // Calculate performance message
            const totalQuestions = quizData.questions.length;
            const scorePercentage = (correctAnswers / totalQuestions) * 100;
            let performanceMessage = "";
            
            if (scorePercentage >= 90) {
                performanceMessage = "Outstanding! You're a master of this subject! 🌟";
            } else if (scorePercentage >= 80) {
                performanceMessage = "Excellent work! You have a solid understanding! 👏";
            } else if (scorePercentage >= 70) {
                performanceMessage = "Good job! You know your stuff! 👍";
            } else if (scorePercentage >= 60) {
                performanceMessage = "Nice effort! You're on the right track! 😊";
            } else {
                performanceMessage = "Keep learning! Practice makes perfect! 📚";
            }
            
            document.getElementById("performance-message").textContent = performanceMessage;
            
            // Show modal
            const modal = document.getElementById("congratulations-modal");
            modal.style.display = "block";
            
            // Show fireworks with proper styling
            const fireworks = document.getElementById('fireworks');
            fireworks.style.display = 'block';
            fireworks.style.position = 'fixed';
            fireworks.style.top = '0';
            fireworks.style.left = '0';
            fireworks.style.width = '100%';
            fireworks.style.height = '100%';
            fireworks.style.zIndex = '9999';
            fireworks.style.pointerEvents = 'none';
            
            // Ensure opacity is set to 1 and clear any previous transition
            fireworks.style.opacity = '1';
            fireworks.style.transition = '';
            
            // Add sparkles
            addSparkles();
            
            // Clear existing children (if any) to prevent duplicates on multiple calls
            const before = fireworks.querySelector('.before');
            const after = fireworks.querySelector('.after');
            if (before) before.style.animation = 'none';
            if (after) after.style.animation = 'none';
            
            // Force a reflow
            void fireworks.offsetWidth;
            
            // Restart the animation
            if (before) before.style.animation = '';
            if (after) after.style.animation = '';
            
            // Set a timeout to stop fireworks after 3 seconds regardless of modal state
            setTimeout(() => {
                hideFireworks();
            }, 5000);
        }
        
        // Helper function to hide and clean up fireworks
        function hideFireworks() {
            fadeOutFireworks();
        }
        
        // Function to fade out fireworks gradually
        function fadeOutFireworks() {
            const fireworks = document.getElementById('fireworks');
            
            // Add a CSS transition for smooth fading
            fireworks.style.transition = 'opacity 4s ease-out';
            fireworks.style.opacity = '0';
            
            // After the transition completes, clean up
            setTimeout(() => {
                fireworks.style.display = 'none';
                
                // Clean up all sparkles
                const sparkles = fireworks.querySelectorAll('.sparkle');
                sparkles.forEach(sparkle => sparkle.remove());
                
                // Reset opacity for next use
                fireworks.style.opacity = '1';
                fireworks.style.transition = '';
                
                // Stop animations
                const before = fireworks.querySelector('.before');
                const after = fireworks.querySelector('.after');
                if (before) before.style.animation = 'none';
                if (after) after.style.animation = 'none';
            }, 4000); // Match the transition duration (4s)
        }
        
        // Function to toggle between upload and quiz views
        function showUploadSection() {
            // Stop any running timer
            stopTimer();
            
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('upload-section').style.display = 'block';
            document.getElementById('upload-section').classList.add('fade-in');
            
            // Reset error message
            document.getElementById('error-message').style.display = 'none';
            
            // Scroll to top to see upload section
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Toggle timer options
        function toggleTimerOptions() {
            const timerToggle = document.getElementById('timer-toggle-switch');
            const timerOptions = document.getElementById('timer-options');
            
            timerEnabled = timerToggle.checked;
            timerOptions.style.display = timerEnabled ? 'flex' : 'none';
        }
        
        // Set timer duration
        function setTimerDuration() {
            const durationSelect = document.getElementById('timer-duration');
            timerDuration = parseInt(durationSelect.value);
        }
        
        // Start the timer
        function startTimer() {
            if (!timerEnabled) return;
            
            // Set the timer duration before starting
            setTimerDuration();
            
            // Show timer display
            const timerDisplay = document.getElementById('quiz-timer');
            timerDisplay.style.display = 'flex';
            
            // Set initial time
            timeRemaining = timerDuration * 60; // convert to seconds
            updateTimerDisplay();
            
            // Start countdown
            clearInterval(timerInterval); // clear any existing timer
            timerInterval = setInterval(function() {
                timeRemaining--;
                updateTimerDisplay();
                
                // Check if time is up
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    handleTimeUp();
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const timerElement = document.getElementById('time-remaining');
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            
            // Format time as MM:SS
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Apply styling based on time remaining
            if (timeRemaining <= 60) { // last minute
                timerElement.className = 'timer-danger';
            } else if (timeRemaining <= 300) { // last 5 minutes
                timerElement.className = 'timer-warning';
            } else {
                timerElement.className = '';
            }
        }
        
        // Handle time up
        function handleTimeUp() {
            alert("Time's up! Your quiz will be submitted now.");
            
            // Mark all unanswered questions as skipped
            for (let i = 0; i < quizData.questions.length; i++) {
                if (!answeredQuestions[i]) {
                    skippedQuestions[i] = true;
                    skippedCount++;
                }
            }
            
            // Update score
            updateScore();
            
            // Show completion modal
            showCongratulations();
        }
        
        // Stop timer
        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Initialize event listeners
        window.onload = function() {
            // Timer toggle listener
            document.getElementById('timer-toggle-switch').addEventListener('change', toggleTimerOptions);
            document.getElementById('timer-duration').addEventListener('change', setTimerDuration);
            
            // Input method toggle listeners
            document.getElementById('upload-toggle').addEventListener('click', function() {
                toggleInputMethod('upload');
            });
            
            document.getElementById('paste-toggle').addEventListener('click', function() {
                toggleInputMethod('paste');
            });
            
            // File upload event listeners
            document.getElementById('upload-button').addEventListener('click', function() {
                document.getElementById('quiz-file').click();
            });
            
            document.getElementById('quiz-file').addEventListener('change', handleFileSelect);
            
            // JSON paste event listeners
            document.getElementById('load-json-btn').addEventListener('click', processPastedJson);
            document.getElementById('clear-json-btn').addEventListener('click', clearJsonInput);
            
            // Sample JSON event listeners
            document.getElementById('sample-button').addEventListener('click', function() {
                toggleSampleDisplay();
                // If paste option is active, add a button to fill the textarea
                if (document.getElementById('paste-toggle').classList.contains('active') && 
                    document.getElementById('json-sample').style.display !== 'none') {
                    const fillButton = document.createElement('button');
                    fillButton.textContent = 'Use this sample';
                    fillButton.className = 'sample-btn';
                    fillButton.style.marginTop = '10px';
                    fillButton.onclick = fillSampleJson;
                    
                    // Only add if it doesn't exist already
                    if (!document.getElementById('fill-sample')) {
                        fillButton.id = 'fill-sample';
                        document.getElementById('json-sample').appendChild(fillButton);
                    }
                }
            });
            
            document.getElementById('copy-sample').addEventListener('click', copySampleToClipboard);
            document.getElementById('download-sample').addEventListener('click', downloadSampleJSON);
            
            // Quiz navigation event listeners
            document.getElementById("next-button").addEventListener("click", nextQuestion);
            document.getElementById("prev-button").addEventListener("click", prevQuestion);
            document.getElementById("skip-button").addEventListener("click", skipQuestion);
            document.getElementById("try-again-button").addEventListener("click", tryAgain);
            document.getElementById("restart-button").addEventListener("click", restartQuiz);
            document.getElementById("review-button").addEventListener("click", reviewWrongAnswers);
            
            // Modal close and restart buttons
            document.getElementById("close-modal-btn").addEventListener("click", function() {
                document.getElementById('congratulations-modal').style.display = 'none';
                hideFireworks();
            });
            document.getElementById("restart-quiz-btn").addEventListener("click", restartQuiz);
            
            // Change quiz button listener
            document.getElementById('change-quiz-button').addEventListener('click', showUploadSection);
        };

        // Add sparkle elements dynamically
        function addSparkles() {
            const fireworks = document.getElementById('fireworks');
            
            // Clear any existing sparkles first to prevent duplicates
            const existingSparkles = fireworks.querySelectorAll('.sparkle');
            existingSparkles.forEach(sparkle => sparkle.remove());
            
            // Add many more sparkles for a rich effect
            for (let i = 0; i < 100; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                
                // Randomize properties for more natural effect
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 3 + 's';
                sparkle.style.animationDuration = (Math.random() * 1 + 1) + 's';
                
                // Randomize size for depth effect
                const size = Math.random() * 6 + 4;
                sparkle.style.width = size + 'px';
                sparkle.style.height = size + 'px';
                
                // Randomize colors for more festive look
                const colors = ['#ffeb3b', '#ff9800', '#ff5722', '#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                sparkle.style.boxShadow = `0 0 10px 2px ${randomColor}, 0 0 20px 4px ${randomColor}`;
                sparkle.style.backgroundColor = randomColor;
                
                fireworks.appendChild(sparkle);
            }
        }
    </script>
</body>
</html>